---
layout: post
title: Topological Sort (coffeescript)
published: true
category: nosql
tags: [algorithm, maizi]
---

{% highlight coffeescript %}
    # topological sort
    top_sort:()->
      result = [] #sort result
      
      node_wrapers = {} #sorting data structure
      for node in @nodes 
        node_wrapers[node.id] = #initialize the data stucture of each node
          node : node
          to : [] #the nodes that has an edge from this node
          visit: 0 #not visited
      for link in @links
        node_wrapers[link.source.id].to.push node_wrapers[link.target.id]

      #visit function for top sort
      visit = (node)->
        if node.visit is 1 #has a temporary mark
           throw "Found a circle"
        if node.visit == 0
          node.visit = 1 #mark n temporarily
          for to_node in node.to
            visit to_node
          node.visit = 2 #mark n permanently
          result.push node.node


      for node_id, node of node_wrapers
        if(node.visit == 0)
          visit(node)
      return result

{% endhighlight %}
